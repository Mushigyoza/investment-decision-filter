<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>é•·æœŸæŠ•è³‡çµ„åˆéæ¿¾å™¨</title>
    <style>
        :root {
            --primary: #2c3e50;
            --accent: #3498db;
            --danger: #e74c3c;
            --success: #27ae60;
            --warning: #f39c12;
            --bg: #f4f6f8;
        }
        body {
            font-family: "Microsoft JhengHei", sans-serif;
            background-color: var(--bg);
            color: var(--primary);
            margin: 0; padding: 15px;
        }
        .container {
            max-width: 1000px;
            margin: 0 auto;
            background: white;
            padding: 25px;
            border-radius: 12px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.08);
        }
        h1 { text-align: center; border-bottom: 2px solid #eee; padding-bottom: 10px; margin-bottom: 20px; }
        
        /* Dashboard Cards */
        .dashboard {
            display: grid; 
            grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
            gap: 15px; 
            margin-bottom: 30px;
        }
        .card { 
            padding: 15px; 
            border-radius: 8px; 
            background: #fff; 
            border: 1px solid #eee;
            border-left: 5px solid #ccc; 
            box-shadow: 0 2px 5px rgba(0,0,0,0.05); 
        }
        .card.over { border-left-color: var(--danger); background: #fff5f5; }
        .card.under { border-left-color: var(--warning); background: #fff9f0; }
        .card.good { border-left-color: var(--success); background: #f0fff4; }
        .card h4 { margin: 0 0 5px 0; font-size: 0.95em; color: #555; display: flex; justify-content: space-between; }
        .card .target-label { font-size: 0.8em; background: #eee; padding: 2px 6px; border-radius: 4px; }
        .card .val { font-size: 1.4em; font-weight: bold; margin: 5px 0; }
        .card .amt { font-size: 0.9em; color: #777; }
        .card .status { font-size: 0.85em; margin-top: 5px; font-weight: bold; }

        /* Table Styling */
        .table-container { overflow-x: auto; }
        table { width: 100%; border-collapse: collapse; min-width: 600px; }
        th { background: #eef2f5; text-align: left; padding: 10px; font-size: 0.9em; }
        td { padding: 8px; border-bottom: 1px solid #eee; }
        
        input, select {
            width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px; box-sizing: border-box; font-size: 1em;
        }
        input:focus, select:focus { outline: none; border-color: var(--accent); }

        /* Buttons */
        .btn-add {
            background: #eee; color: #333; border: 1px dashed #999; 
            width: 100%; padding: 10px; margin-top: 10px; cursor: pointer; border-radius: 6px;
        }
        .btn-add:hover { background: #e0e0e0; }
        
        .btn-del {
            background: #ffeded; color: var(--danger); border: none; 
            padding: 5px 10px; border-radius: 4px; cursor: pointer; font-size: 0.8em;
        }
        
        .btn-main {
            background: var(--accent); color: white; border: none; padding: 15px;
            font-size: 1.2em; border-radius: 8px; cursor: pointer; width: 100%; margin-top: 30px;
            box-shadow: 0 4px 0 #2980b9; transition: transform 0.1s;
        }
        .btn-main:active { transform: translateY(4px); box-shadow: none; }

        /* Total Assets Display */
        .total-banner {
            background: #2c3e50; color: white; padding: 15px; border-radius: 8px;
            margin-bottom: 20px; display: flex; justify-content: space-between; align-items: center;
        }

        /* Quiz Section */
        #quiz-section { display: none; margin-top: 40px; border-top: 2px dashed #ccc; padding-top: 20px; }
        .q-item { background: #f9f9f9; padding: 15px; margin-bottom: 15px; border-radius: 6px; }
        
        /* Result Bar */
        #final-result {
            display: none; position: fixed; bottom: 0; left: 0; width: 100%; padding: 20px;
            text-align: center; z-index: 999; font-weight: bold; box-shadow: 0 -2px 10px rgba(0,0,0,0.1);
        }
        .res-stop { background: #ffebee; color: #c0392b; border-top: 5px solid var(--danger); }
        .res-go { background: #e8f5e9; color: #2e7d32; border-top: 5px solid var(--success); }
    </style>
</head>
<body>

<div class="container">
    <h1>è‡ªé¸é…ç½®å†å¹³è¡¡è¨ˆç®—æ©Ÿ (V3)</h1>

    <div class="total-banner">
        <span>äº¤æ˜“å¾Œé ä¼°ç¸½è³‡ç”¢</span>
        <span style="font-size: 1.5em; font-weight: bold;" id="total-assets">0</span>
    </div>

    <div class="dashboard">
        <div class="card" id="card-core">
            <h4>æ ¸å¿ƒé…ç½® <span class="target-label">ç›®æ¨™ 40-50%</span></h4>
            <div class="val" id="pct-core">0%</div>
            <div class="amt" id="amt-core">$0</div>
            <div class="status" id="status-core">--</div>
        </div>
        <div class="card" id="card-global">
            <h4>å…¨çƒé…ç½® <span class="target-label">ç›®æ¨™ 25-35%</span></h4>
            <div class="val" id="pct-global">0%</div>
            <div class="amt" id="amt-global">$0</div>
            <div class="status" id="status-global">--</div>
        </div>
        <div class="card" id="card-tech">
            <h4>ç§‘æŠ€é…ç½® <span class="target-label">ç›®æ¨™ 15-25%</span></h4>
            <div class="val" id="pct-tech">0%</div>
            <div class="amt" id="amt-tech">$0</div>
            <div class="status" id="status-tech">--</div>
        </div>
        <div class="card" id="card-other">
            <h4>å…¶ä»–/å€‹è‚¡ <span class="target-label">ç›®æ¨™ â‰¤10%</span></h4>
            <div class="val" id="pct-other">0%</div>
            <div class="amt" id="amt-other">$0</div>
            <div class="status" id="status-other">--</div>
        </div>
    </div>

    <h3>æŒè‚¡æ˜ç´°èˆ‡äº¤æ˜“è©¦ç®—</h3>
    <div class="table-container">
        <table id="stock-table">
            <thead>
                <tr>
                    <th style="width: 15%;">ä»£è™Ÿ/åç¨±</th>
                    <th style="width: 20%;">æ­¸é¡</th>
                    <th style="width: 20%;">ç›®å‰åº«å­˜</th>
                    <th style="width: 20%;">åŠ ç¢¼(+) / è³£å‡º(-)</th>
                    <th style="width: 20%;">äº¤æ˜“å¾Œé‡‘é¡</th>
                    <th style="width: 5%;"></th>
                </tr>
            </thead>
            <tbody id="table-body">
                </tbody>
        </table>
    </div>
    <button class="btn-add" onclick="addRow()">+ æ–°å¢ä¸€åˆ—è‚¡ç¥¨</button>

    <button class="btn-main" onclick="startCheck()">ç¢ºèªé…ç½®ï¼Œé€²å…¥å¿ƒç†æª¢æŸ¥</button>

    <div id="quiz-section">
        <h3>æœ€å¾Œä¸€æ­¥ï¼šæ±ºç­–å“è³ªæª¢æŸ¥</h3>
        <div class="q-item">
            <p><strong>1. é€™å€‹äº¤æ˜“å‹•ä½œçš„ä¸»è¦å‹•æ©Ÿæ˜¯ï¼Ÿ</strong></p>
            <label><input type="radio" name="q1" value="pass" onchange="checkResult()"> ç‚ºäº†è®“è³‡ç”¢æ¯”ä¾‹å›åˆ°ç›®æ¨™å€é–“ (å†å¹³è¡¡)</label><br>
            <label><input type="radio" name="q1" value="stop" onchange="checkResult()"> è¦ºå¾—æŸæ”¯è‚¡ç¥¨è¦æ¼²äº†æƒ³è¿½ï¼Œæˆ–æ˜¯è·Œäº†æƒ³ç  (æƒ…ç·’)</label>
        </div>
        <div class="q-item">
            <p><strong>2. å£“åŠ›æ¸¬è©¦ï¼šå¦‚æœäº¤æ˜“å¾Œæ˜å¤©è·Œ 30%...</strong></p>
            <label><input type="radio" name="q2" value="pass" onchange="checkResult()"> æˆ‘é‚„èƒ½ç¡å¾—è‘—ï¼Œç”Ÿæ´»ä¸å—å½±éŸ¿</label><br>
            <label><input type="radio" name="q2" value="stop" onchange="checkResult()"> æˆ‘æœƒéå¸¸ç„¦æ…®ï¼Œç”šè‡³æƒ³åœæ</label>
        </div>
        <div class="q-item">
            <p><strong>3. é€™äº›éŒ¢çš„é–’ç½®æ™‚é–“ï¼Ÿ</strong></p>
            <label><input type="radio" name="q3" value="pass" onchange="checkResult()"> 10 å¹´ä»¥ä¸Šä¸æœƒç”¨åˆ°</label><br>
            <label><input type="radio" name="q3" value="stop" onchange="checkResult()"> 1-2 å¹´å…§å¯èƒ½æœƒæ‹¿ä¾†ç”¨</label>
        </div>
    </div>
</div>

<div id="final-result">
    <div id="result-msg"></div>
</div>

<script>
    // å®šç¾©è¦å‰‡
    const RULES = {
        core:   { min: 40, max: 50 },
        global: { min: 25, max: 35 },
        tech:   { min: 15, max: 25 },
        other:  { min: 0,  max: 10 }
    };

    // åˆå§‹åŒ–ï¼šé è¨­åŠ å…¥å…©åˆ—æ–¹ä¾¿ä½¿ç”¨è€…è¼¸å…¥
    window.onload = function() {
        addRow('006208', 'core');
        addRow('VT', 'global');
    };

    function addRow(defaultName = '', defaultCat = 'core') {
        const tbody = document.getElementById('table-body');
        const tr = document.createElement('tr');
        
        tr.innerHTML = `
            <td><input type="text" placeholder="å¦‚ 2330" value="${defaultName}"></td>
            <td>
                <select onchange="calc()">
                    <option value="core" ${defaultCat==='core'?'selected':''}>æ ¸å¿ƒ (å¤§ç›¤)</option>
                    <option value="global" ${defaultCat==='global'?'selected':''}>å…¨çƒ (VT/ACWI)</option>
                    <option value="tech" ${defaultCat==='tech'?'selected':''}>ç§‘æŠ€ (0052/QQQ)</option>
                    <option value="other" ${defaultCat==='other'?'selected':''}>å…¶ä»– (å€‹è‚¡/å‚µåˆ¸)</option>
                </select>
            </td>
            <td><input type="number" class="cur-val" placeholder="0" oninput="calc()"></td>
            <td><input type="number" class="trade-val" placeholder="0" oninput="calc()"></td>
            <td class="final-val">0</td>
            <td><button class="btn-del" onclick="removeRow(this)">âœ•</button></td>
        `;
        tbody.appendChild(tr);
    }

    function removeRow(btn) {
        const row = btn.parentNode.parentNode;
        row.parentNode.removeChild(row);
        calc();
    }

    function calc() {
        // 1. æ­¸é›¶è¨ˆæ•¸å™¨
        let totals = { core: 0, global: 0, tech: 0, other: 0 };
        let grandTotal = 0;

        // 2. éæ­·æ‰€æœ‰åˆ—
        const rows = document.querySelectorAll('#table-body tr');
        rows.forEach(row => {
            const cat = row.querySelector('select').value;
            const cur = parseFloat(row.querySelector('.cur-val').value) || 0;
            const trade = parseFloat(row.querySelector('.trade-val').value) || 0;
            
            const final = cur + trade;
            
            // æ›´æ–°è©²åˆ—çš„é¡¯ç¤º
            row.querySelector('.final-val').innerText = final.toLocaleString();
            
            // åŠ ç¸½åˆ°å°æ‡‰é¡åˆ¥
            if (totals[cat] !== undefined) {
                totals[cat] += final;
            }
            grandTotal += final;
        });

        // 3. æ›´æ–°ç¸½è³‡ç”¢é¡¯ç¤º
        document.getElementById('total-assets').innerText = "$ " + grandTotal.toLocaleString();

        // 4. æ›´æ–°å„€è¡¨æ¿å¡ç‰‡ç‹€æ…‹
        updateCard('core', totals.core, grandTotal);
        updateCard('global', totals.global, grandTotal);
        updateCard('tech', totals.tech, grandTotal);
        updateCard('other', totals.other, grandTotal);

        checkResult(); // æª¢æŸ¥å•å·ç‹€æ…‹
    }

    function updateCard(type, amount, total) {
        const pct = total > 0 ? (amount / total * 100) : 0;
        const rule = RULES[type];
        
        // DOM Elements
        const card = document.getElementById(`card-${type}`);
        const elPct = document.getElementById(`pct-${type}`);
        const elAmt = document.getElementById(`amt-${type}`);
        const elStatus = document.getElementById(`status-${type}`);

        // Update Text
        elPct.innerText = pct.toFixed(1) + "%";
        elAmt.innerText = "$ " + amount.toLocaleString();
        
        // Determine Status Color
        card.className = "card"; // reset
        if (pct > rule.max) {
            card.classList.add('over');
            elStatus.innerText = `âš ï¸ éé‡ (ä¸Šé™ ${rule.max}%)`;
            elStatus.style.color = "#c0392b";
        } else if (pct < rule.min) {
            card.classList.add('under');
            elStatus.innerText = `ğŸ’¡ éè¼• (ä¸‹é™ ${rule.min}%)`;
            elStatus.style.color = "#d35400";
        } else {
            card.classList.add('good');
            elStatus.innerText = "âœ… æ¯”ä¾‹å®Œç¾";
            elStatus.style.color = "#27ae60";
        }
    }

    function startCheck() {
        const grandTotal = parseFloat(document.getElementById('total-assets').innerText.replace(/[$,]/g, '')) || 0;
        if (grandTotal === 0) {
            alert("è«‹å…ˆè¼¸å…¥è³‡ç”¢æ•¸æ“šï¼");
            return;
        }
        document.getElementById('quiz-section').style.display = 'block';
        // Scroll to bottom
        setTimeout(() => {
            window.scrollTo({ top: document.body.scrollHeight, behavior: 'smooth' });
        }, 100);
    }

    function checkResult() {
        // åªæœ‰ç•¶å•å·å€é¡¯ç¤ºæ™‚æ‰æª¢æŸ¥çµæœ
        if (document.getElementById('quiz-section').style.display === 'none') return;

        const q1 = document.querySelector('input[name="q1"]:checked')?.value;
        const q2 = document.querySelector('input[name="q2"]:checked')?.value;
        const q3 = document.querySelector('input[name="q3"]:checked')?.value;
        
        const resDiv = document.getElementById('final-result');
        const msgDiv = document.getElementById('result-msg');

        if (q1 && q2 && q3) {
            resDiv.style.display = 'block';
            if (q1 === 'stop' || q2 === 'stop' || q3 === 'stop') {
                resDiv.className = 'res-stop';
                msgDiv.innerHTML = "ğŸ›‘ è­¦å‘Šï¼šä½ çš„å¿ƒæ…‹æˆ–é¢¨éšªæ‰¿å—åº¦ä¸ç¬¦åˆæ¨™æº–ï¼Œè«‹<b>åœæ­¢äº¤æ˜“</b>ä¸¦å†·éœæ€è€ƒã€‚";
            } else {
                resDiv.className = 'res-go';
                msgDiv.innerHTML = "âœ… é€šéï¼šé…ç½®ç¬¦åˆç´€å¾‹ä¸”å¿ƒæ…‹æ­£ç¢ºï¼Œ<b>å¯ä»¥åŸ·è¡Œäº¤æ˜“</b>ã€‚";
            }
        } else {
            resDiv.style.display = 'none';
        }
    }
</script>

</body>
</html>
